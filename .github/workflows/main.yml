name: content-automation-wp-test

on:
  # Manual trigger only for now (no schedule yet)
  workflow_dispatch:

jobs:
  wp-publish-test:
    runs-on: ubuntu-latest

    env:
      WP_URL: ${{ secrets.WP_URL }}
      WP_USER: ${{ secrets.WP_USER }}
      WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      PYTHONPATH: ${{ github.workspace }}


    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install flask feedparser beautifulsoup4 pandas schedule python-dotenv requests lxml gspread google-auth openai

      - name: Run WordPress publisher test
        working-directory: ./workers
        run: |
          echo "Running wp_publish.py test (example_usage)..."
          python wp_publish.py
